# OpenBioCard Server

âœ¨ OpenBioCard çš„ç‹¬ç«‹é«˜æ€§èƒ½åç«¯å®ç° âœ¨

> æ³¨æ„ï¼šæœ¬é¡¹ç›®ä¸å±äº OpenBioCard å®˜æ–¹ã€‚

![.NET](https://img.shields.io/badge/.NET-8.0%2B-512BD4?logo=dotnet)
![Docker](https://img.shields.io/badge/Docker-Supported-2496ED?logo=docker)
![License](https://img.shields.io/badge/license-MIT-green)

[English](./README.MD) | [ğŸ“š API æ–‡æ¡£](./DOCUMENTS.zh-CN.MD)

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®ç®€ä»‹](#-é¡¹ç›®ç®€ä»‹)
- [åŠŸèƒ½ç‰¹æ€§](#-åŠŸèƒ½ç‰¹æ€§)
- [åŠŸèƒ½å·®å¼‚è¯´æ˜](#-åŠŸèƒ½å·®å¼‚è¯´æ˜)
- [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [ç¯å¢ƒé…ç½®](#-ç¯å¢ƒé…ç½®)
- [éƒ¨ç½²æŒ‡å—](#-éƒ¨ç½²æŒ‡å—)
- [é¡¹ç›®ç»“æ„](#-é¡¹ç›®ç»“æ„)
- [æŠ€æœ¯æ ˆ](#-æŠ€æœ¯æ ˆ)
- [è®¸å¯è¯](#-è®¸å¯è¯)

## ğŸŒŸ é¡¹ç›®ç®€ä»‹

**OpenBioCard Server** æ˜¯ [OpenBioCard](https://github.com/OpenBioCard/OpenBioCard/) ç”Ÿæ€ç³»ç»Ÿçš„ç‹¬ç«‹åç«¯è§£å†³æ–¹æ¡ˆã€‚

ä¸åŸç‰ˆåŸºäº Cloudflare Workers çš„å®ç°ä¸åŒï¼Œæœ¬é¡¹ç›®åŸºäº **C# ASP.NET Core** æ„å»ºï¼Œä¸“ä¸ºä¼ ç»ŸæœåŠ¡å™¨ã€VPS æˆ–å®¹å™¨åŒ–éƒ¨ç½²ï¼ˆDocker/Kubernetesï¼‰è®¾è®¡ã€‚

å®ƒæä¾›äº†ä¸ OpenBioCard å‰ç«¯å…¼å®¹çš„ RESTful APIï¼Œå…è®¸æ‚¨ä½¿ç”¨ SQLite æˆ– PostgreSQL åœ¨è‡ªå·±çš„åŸºç¡€è®¾æ–½ä¸Šå®Œå…¨æŒæ§æ•°æ®ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½** - åŸºäºæé€Ÿçš„ ASP.NET Core æ¡†æ¶æ„å»ºã€‚
- ğŸ’¾ **çµæ´»å­˜å‚¨** - å¼€å‘ç¯å¢ƒé»˜è®¤æ”¯æŒ **SQLite**ï¼Œç”Ÿäº§ç¯å¢ƒæ”¯æŒ **PostgreSQL**ã€‚
- ğŸ³ **å®¹å™¨åŒ–** - æä¾›å®Œå–„çš„ Docker æ”¯æŒï¼Œéƒ¨ç½²è½»æ¾ä¾¿æ·ã€‚
- ğŸ“„ **OpenAPI æ”¯æŒ** - åŸç”Ÿé›†æˆ Swagger/OpenAPIï¼Œä¾¿äºæ¥å£è°ƒè¯•ã€‚
- ğŸ› ï¸ **è·¨å¹³å°** - æ”¯æŒ Linux, Windows, macOS ç­‰æ‰€æœ‰ .NET æ”¯æŒçš„å¹³å°ã€‚

## âš ï¸ åŠŸèƒ½å·®å¼‚è¯´æ˜

> **å…³äºæ¶æ„å·®å¼‚ä¸å…¼å®¹é…ç½®ï¼š**
>
> æœ¬é¡¹ç›®åŸºäºå…³ç³»å‹æ•°æ®åº“é‡æ„ï¼Œåº•å±‚æ•°æ®æ¨¡å‹ä¸ä¸Šæ¸¸é¡¹ç›®å­˜åœ¨æœ¬è´¨å·®å¼‚ã€‚è‹¥é…åˆä¸Šæ¸¸é¡¹ç›®çš„å‰ç«¯ä½¿ç”¨ï¼Œè¯·åŠ¡å¿…å°† API ç«¯ç‚¹é…ç½®ä¸º `/classic` ä»¥å¯ç”¨å…¼å®¹å±‚ã€‚

> **å…³äºåŠŸèƒ½æ¼”è¿›ä¸æ½œåœ¨å†²çªï¼š**
>
> æœ¬é¡¹ç›®è‡´åŠ›äºæ„å»ºæ›´å®Œå–„çš„å®‰å…¨ä½“ç³»ï¼ˆå¦‚å¼•å…¥é‚®ä»¶éªŒè¯ç ã€TOTP åŒå› ç´ è®¤è¯ç­‰ï¼‰å¹¶æä¾›æ›´å¤šæ‰©å±•ç‰¹æ€§ã€‚è¯·æ³¨æ„ï¼Œéšç€å·®å¼‚åŒ–åŠŸèƒ½çš„è¿­ä»£ï¼Œæœªæ¥ç‰ˆæœ¬å¯èƒ½ä¼šåœ¨ä¸€å®šç¨‹åº¦ä¸Šç‰ºç‰²å¯¹ä¸Šæ¸¸é¡¹ç›®çš„å®Œå…¨å…¼å®¹æ€§ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- **.NET SDK**: 8.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **æ•°æ®åº“**: PostgreSQLï¼ˆå¯é€‰ï¼Œå¼€å‘ç¯å¢ƒé»˜è®¤ä½¿ç”¨ SQLiteï¼‰

### æœ¬åœ°å¼€å‘

1. **å…‹éš†ä»“åº“**

2. **æ£€æŸ¥é…ç½®**
   é¡¹ç›®é»˜è®¤ä½¿ç”¨ `appsettings.Development.json`ã€‚
   ```json
   // appsettings.Development.json
   "ConnectionStrings": {
     "DefaultConnection": "Data Source=development.db"
   }
   ```

3. **è¿è¡Œåº”ç”¨**
   ```bash
   dotnet run
   ```
   æœåŠ¡å™¨å°†å¯åŠ¨åœ¨ `http://localhost:5046`ï¼ˆæˆ–é…ç½®çš„ç«¯å£ï¼‰ã€‚
   
   > éœ€è¦é…ç½® OpenBioCard åç«¯åœ°å€ä¸º `http://localhost:5046/classic` ï¼ˆæˆ–ä½ çš„å…¶ä»–ç«¯å£ï¼‰ã€‚

4. **è®¿é—® Swagger UI**
   è®¿é—® `http://localhost:5046/swagger` æŸ¥çœ‹ API æ–‡æ¡£å¹¶è¿›è¡Œè°ƒè¯•ã€‚

## âš™ï¸ ç¯å¢ƒé…ç½®

é…ç½®é€šè¿‡ `appsettings.json` æˆ–ç¯å¢ƒå˜é‡è¿›è¡Œç®¡ç†ã€‚

| é…ç½®é¡¹ | ç¯å¢ƒå˜é‡ Key | è¯´æ˜ |
| :--- | :--- | :--- |
| `ConnectionStrings:DefaultConnection` | `ConnectionStrings__DefaultConnection` | æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼ˆPostgresï¼‰æˆ–æ–‡ä»¶è·¯å¾„ï¼ˆSQLiteï¼‰ã€‚ |
| `AuthSettings:RootUsername` | `AuthSettings__RootUsername` | ç³»ç»Ÿç®¡ç†å‘˜ç”¨æˆ·åã€‚ |
| `AuthSettings:RootPassword` | `AuthSettings__RootPassword` | **å¿…å¡«**ã€‚ç³»ç»Ÿç®¡ç†å‘˜å¯†ç ã€‚ |
| `CorsSettings:AllowedOrigins` | `CorsSettings__AllowedOrigins` | å…è®¸çš„å‰ç«¯åŸŸååˆ—è¡¨ï¼ˆé€—å·åˆ†éš”ï¼‰ã€‚ |
| `AppSettings::Version` | `AppSettings__Version` | `/check-backend` è¿”å›ç»™å‰ç«¯çš„æœåŠ¡å™¨ç‰ˆæœ¬åç§°ã€‚ |

## ğŸ—ï¸ éƒ¨ç½²æŒ‡å—

### æ–¹å¼ä¸€ï¼šDocker Composeï¼ˆæ¨èï¼‰

è¿™æ˜¯éƒ¨ç½²æœåŠ¡å™¨å’Œ PostgreSQL æ•°æ®åº“æœ€ç®€å•çš„æ–¹æ³•ã€‚

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½² (Linux)

1. **å‘å¸ƒåº”ç”¨ï¼š**
   ```bash
   dotnet publish -c Release -o ./publish
   ```
2. **ä¸Šä¼ æ–‡ä»¶** åˆ°æ‚¨çš„æœåŠ¡å™¨ç›®å½•ã€‚
3. **è®¾ç½®ç¯å¢ƒå˜é‡** é…ç½®ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“è¿æ¥ã€‚
4. **è¿è¡Œï¼š** `dotnet OpenBioCardServer.dll`

## ğŸ“ é¡¹ç›®ç»“æ„

```
OpenBioCardServer/
â”œâ”€â”€ Controllers/      # API æ§åˆ¶å™¨
â”œâ”€â”€ Data/             # EF Core ä¸Šä¸‹æ–‡ä¸è¿ç§»
â”œâ”€â”€ Middlewares/      # ä¸­é—´ä»¶
â”œâ”€â”€ Models/           # æ•°æ®åº“å®ä½“æ¨¡å‹
â”œâ”€â”€ Services/         # ä¸šåŠ¡é€»è¾‘ (Auth, User, Admin)
â”œâ”€â”€ Utilities/        # å·¥å…·ç±»
â”œâ”€â”€ Program.cs        # ç¨‹åºå…¥å£ä¸ä¾èµ–æ³¨å…¥é…ç½®
â”œâ”€â”€ appsettings.json  # é…ç½®æ–‡ä»¶
â””â”€â”€ Dockerfile        # å®¹å™¨æ„å»ºæ–‡ä»¶
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **æ¡†æ¶:** .NET 8 / ASP.NET Core
- **ORM:** Entity Framework Core
- **æ•°æ®åº“:** PostgreSQL (Npgsql) / SQLite
- **æ–‡æ¡£:** Microsoft.AspNetCore.OpenApi

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

---

