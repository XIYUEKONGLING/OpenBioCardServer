# OpenBioCard Server

âœ¨ OpenBioCard çš„ç‹¬ç«‹é«˜æ€§èƒ½åç«¯å®ç° âœ¨

![.NET](https://img.shields.io/badge/.NET-10.0%2B-512BD4?logo=dotnet)
![Docker](https://img.shields.io/badge/Docker-Supported-2496ED?logo=docker)
![License](https://img.shields.io/badge/license-MIT-green)

[English](./README.MD) | [ğŸ“š API æ–‡æ¡£](./DOCUMENTS.zh-CN.MD)

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®ç®€ä»‹](#-é¡¹ç›®ç®€ä»‹)
- [åŠŸèƒ½ç‰¹æ€§](#-åŠŸèƒ½ç‰¹æ€§)
- [åŠŸèƒ½å·®å¼‚è¯´æ˜](#-åŠŸèƒ½å·®å¼‚è¯´æ˜)
- [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [ç¯å¢ƒé…ç½®](#-ç¯å¢ƒé…ç½®)
- [éƒ¨ç½²æŒ‡å—](#-éƒ¨ç½²æŒ‡å—)
- [é¡¹ç›®ç»“æ„](#-é¡¹ç›®ç»“æ„)
- [æŠ€æœ¯æ ˆ](#-æŠ€æœ¯æ ˆ)
- [è®¸å¯è¯](#-è®¸å¯è¯)

## ğŸŒŸ é¡¹ç›®ç®€ä»‹

**OpenBioCard Server** æ˜¯ [OpenBioCard](https://github.com/OpenBioCard/OpenBioCard/) ç”Ÿæ€ç³»ç»Ÿçš„ç‹¬ç«‹åç«¯è§£å†³æ–¹æ¡ˆã€‚

ä¸åŸç‰ˆåŸºäº Cloudflare Workers çš„å®ç°ä¸åŒï¼Œæœ¬é¡¹ç›®åŸºäº **C# ASP.NET Core** æ„å»ºï¼Œä¸“ä¸ºä¼ ç»ŸæœåŠ¡å™¨ã€VPS æˆ–å®¹å™¨åŒ–éƒ¨ç½²ï¼ˆDocker/Kubernetesï¼‰è®¾è®¡ã€‚

å®ƒæä¾›äº†ä¸ OpenBioCard å‰ç«¯å…¼å®¹çš„ RESTful APIï¼Œå…è®¸æ‚¨ä½¿ç”¨ SQLite æˆ– PostgreSQL åœ¨è‡ªå·±çš„åŸºç¡€è®¾æ–½ä¸Šå®Œå…¨æŒæ§æ•°æ®ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½** - åŸºäºæé€Ÿçš„ ASP.NET Core æ¡†æ¶æ„å»ºï¼Œé›†æˆ **å“åº”å‹ç¼©** (Brotli/Gzip) ä¸ **å¤šçº§ç¼“å­˜** (å†…å­˜/Redis) æœºåˆ¶ã€‚
- ğŸ’¾ **çµæ´»å­˜å‚¨** - æ”¯æŒ **SQLite**ã€**PostgreSQL** å’Œ **MySQL**ï¼Œå¯æ ¹æ®éœ€æ±‚çµæ´»åˆ‡æ¢ã€‚
- ğŸ›¡ï¸ **å®‰å…¨é˜²æŠ¤** - å†…ç½®ç™»å½•æ¥å£é™æµä¿æŠ¤ï¼ˆ10æ¬¡/åˆ†é’Ÿï¼‰ï¼Œé˜²æ­¢æš´åŠ›ç ´è§£ã€‚
- ğŸ³ **å®¹å™¨åŒ–** - æä¾›å®Œå–„çš„ Docker æ”¯æŒï¼Œéƒ¨ç½²è½»æ¾ä¾¿æ·ã€‚
- ğŸ“„ **OpenAPI æ”¯æŒ** - åŸç”Ÿé›†æˆ Swagger/OpenAPIï¼Œä¾¿äºæ¥å£è°ƒè¯•ã€‚
- ğŸ› ï¸ **è·¨å¹³å°** - æ”¯æŒ Linux, Windows, macOS ç­‰æ‰€æœ‰ .NET æ”¯æŒçš„å¹³å°ã€‚

## âš ï¸ åŠŸèƒ½å·®å¼‚è¯´æ˜

> **å…³äºæ¶æ„å·®å¼‚ä¸å…¼å®¹é…ç½®ï¼š**
>
> æœ¬é¡¹ç›®åŸºäºå…³ç³»å‹æ•°æ®åº“é‡æ„ï¼Œåº•å±‚æ•°æ®æ¨¡å‹ä¸ä¸Šæ¸¸é¡¹ç›®å­˜åœ¨æœ¬è´¨å·®å¼‚ã€‚è‹¥é…åˆä¸Šæ¸¸é¡¹ç›®çš„å‰ç«¯ä½¿ç”¨ï¼Œè¯·åŠ¡å¿…å°† API ç«¯ç‚¹é…ç½®ä¸º `/classic` ä»¥å¯ç”¨å…¼å®¹å±‚ã€‚

> å…¼å®¹å±‚å°†æŒç»­å…¼å®¹ä¸Šæ¸¸é¡¹ç›®å‰ç«¯éƒ¨åˆ†ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- **.NET SDK**: 10.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **æ•°æ®åº“**: PostgreSQL æˆ– MySQLï¼ˆå¯é€‰ï¼Œå¼€å‘ç¯å¢ƒé»˜è®¤ä½¿ç”¨ SQLiteï¼‰

### æœ¬åœ°å¼€å‘

#### åç«¯éƒ¨åˆ†

1. **å…‹éš†ä»“åº“**

2. **æ£€æŸ¥é…ç½®**
   é¡¹ç›®é»˜è®¤ä½¿ç”¨ `appsettings.Development.json`ã€‚

   ```bash
   $ cd OpenBioCardServer
   $ vim appsettings.Development.json
   ```

   ```json
   // appsettings.Development.json
   "DatabaseSettings": {
     "Type": "SQLite",
     "ConnectionString": "Data Source=development.db"
   }
   ```

3. **è¿è¡Œåº”ç”¨**
   ```bash
   dotnet run
   ```
   æœåŠ¡å™¨å°†å¯åŠ¨åœ¨ `http://localhost:5046`ï¼ˆæˆ–é…ç½®çš„ç«¯å£ï¼‰ã€‚

   > éœ€è¦é…ç½® OpenBioCard åç«¯åœ°å€ä¸º `http://localhost:5046/classic` ï¼ˆæˆ–ä½ çš„å…¶ä»–ç«¯å£ï¼‰ã€‚

4. **è®¿é—® Swagger UI**
   è®¿é—® `http://localhost:5046/swagger` æŸ¥çœ‹ API æ–‡æ¡£å¹¶è¿›è¡Œè°ƒè¯•ã€‚

#### å‰ç«¯éƒ¨åˆ†

1. **å…‹éš†ä»“åº“** `https://github.com/OpenBioCard/OpenBioCard.git`

2. **å®‰è£…ä¾èµ–**

   ```bash
   $ pnpm install
   ```

3. æ›´æ”¹å‰ç«¯ API ç«¯ç‚¹ ï¼ˆæˆ–è€…**ç›´æ¥æ›´æ”¹æºä»£ç æ–‡ä»¶ä¸­ç¡¬ç¼–ç çš„éƒ¨åˆ†**ï¼‰

   ```bash
   $ vim apps/frontend/.env.local
   ```

   ```env
   VITE_API_BASE_URL=http://localhost:5046/classic
   ```

4. å¯åŠ¨åº”ç”¨

   ```bash
   $ cd apps/frontend
   $ pnpm dev
   ```

## âš™ï¸ ç¯å¢ƒé…ç½®

é…ç½®é€šè¿‡ `appsettings.json` æˆ–ç¯å¢ƒå˜é‡è¿›è¡Œç®¡ç†ã€‚
ä½¿ç”¨ç¯å¢ƒå˜é‡æ—¶ï¼Œè¯·ä½¿ç”¨åŒä¸‹åˆ’çº¿ `__` ä½œä¸ºå±‚çº§åˆ†éš”ç¬¦ï¼ˆä¾‹å¦‚ï¼š`CacheSettings__Enabled`ï¼‰ã€‚

| åˆ†ç±» | é…ç½®é¡¹ | ç¯å¢ƒå˜é‡ Key | è¯´æ˜ | é»˜è®¤å€¼ |
| :--- | :--- | :--- | :--- | :--- |
| **æ•°æ®åº“** | `Type` | `DatabaseSettings__Type` | æ•°æ®åº“ç±»å‹ï¼š`SQLite`, `PgSQL`, `MySQL`ã€‚ | - |
| | `ConnectionString` | `DatabaseSettings__ConnectionString` | æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€‚ | - |
| **è®¤è¯** | `RootUsername` | `AuthSettings__RootUsername` | ç³»ç»Ÿ Root ç®¡ç†å‘˜ç”¨æˆ·åã€‚ | - |
| | `RootPassword` | `AuthSettings__RootPassword` | **å¿…å¡«**ã€‚ç³»ç»Ÿ Root ç®¡ç†å‘˜å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰ã€‚ | - |
| **ç¼“å­˜** | `Enabled` | `CacheSettings__Enabled` | æ˜¯å¦å¯ç”¨ç¼“å­˜å±‚çš„æ€»å¼€å…³ã€‚ | `true` |
| | `UseRedis` | `CacheSettings__UseRedis` | æ˜¯å¦ä½¿ç”¨ Redisã€‚`false` ä¸ºä½¿ç”¨æœ¬æœºå†…å­˜ç¼“å­˜ã€‚ | `false` |
| | `RedisConnectionString` | `CacheSettings__RedisConnectionString` | Redis è¿æ¥å­—ç¬¦ä¸² (å¯ç”¨ Redis æ—¶å¿…å¡«)ã€‚ | - |
| | `InstanceName` | `CacheSettings__InstanceName` | Redis é”®å‰ç¼€ï¼Œç”¨äºæ•°æ®éš”ç¦»ã€‚ | `OpenBioCard:` |
| | `CacheSizeLimit` | `CacheSettings__CacheSizeLimit` | å†…å­˜ç¼“å­˜çš„æœ€å¤§æ¡ç›®æ•°é‡é™åˆ¶ (éå­—èŠ‚å¤§å°)ã€‚ | `null` |
| | `ExpirationMinutes` | `CacheSettings__ExpirationMinutes` | ç»å¯¹è¿‡æœŸæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ã€‚ | `30` |
| | `SlidingExpirationMinutes` | `CacheSettings__SlidingExpirationMinutes` | æ»‘åŠ¨è¿‡æœŸæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ï¼Œè®¿é—®æ—¶è‡ªåŠ¨ç»­æœŸã€‚ | `5` |
| | `CompactionPercentage` | `CacheSettings__CompactionPercentage` | å†…å­˜ç¼“å­˜æ»¡æ—¶æ¸…ç†çš„æ¯”ä¾‹ (0.0 - 1.0)ã€‚ | `0.2` |
| | `FactorySoftTimeoutMilliseconds` | `CacheSettings__FactorySoftTimeoutMilliseconds` | ç¼“å­˜å·¥å‚è½¯è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚ | `500` |
| | `EnableFailSafe` | `CacheSettings__EnableFailSafe` | æ˜¯å¦å¯ç”¨æ•…éšœå…œåº• (Fail-Safe) æœºåˆ¶ã€‚ | `true` |
| | `FailSafeMaxDurationMinutes` | `CacheSettings__FailSafeMaxDurationMinutes` | æ•…éšœå…œåº•æ—¶é™ˆæ—§æ•°æ®çš„æœ€å¤§ä¿ç•™æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ã€‚ | `120` |
| | `FailSafeThrottleDurationSeconds` | `CacheSettings__FailSafeThrottleDurationSeconds` | ç¬æ—¶æ•…éšœçš„èŠ‚æµæ—¶é—´ï¼ˆç§’ï¼‰ã€‚ | `30` |
| | `DistributedCacheCircuitBreakerDurationSeconds` | `CacheSettings__DistributedCacheCircuitBreakerDurationSeconds` | åˆ†å¸ƒå¼ç¼“å­˜ç†”æ–­æ—¶é—´ï¼ˆç§’ï¼‰ã€‚ | `2` |
| **å‹ç¼©** | `Enabled` | `CompressionSettings__Enabled` | æ˜¯å¦å¯ç”¨ Gzip/Brotli å“åº”å‹ç¼©ã€‚ | `true` |
| | `EnableForHttps` | `CompressionSettings__EnableForHttps` | æ˜¯å¦åœ¨ HTTPS è¯·æ±‚ä¸­å¯ç”¨å‹ç¼©ã€‚ | `true` |
| | `Level` | `CompressionSettings__Level` | å‹ç¼©çº§åˆ«ï¼š`Fastest` (æœ€å¿«), `Optimal` (æœ€ä½³), `SmallestSize` (æœ€å°ä½“ç§¯)ã€‚ | `Fastest` |
| **é™æµ** | `Policies` | `RateLimitSettings__Policies__0__...` | é™æµç­–ç•¥åˆ—è¡¨é…ç½®ã€‚ | `[]` |
| | `[n].PolicyName` | `...__PolicyName` | **å¿…å¡«**ã€‚ç­–ç•¥åç§°ï¼ˆå¦‚ `login`, `general`ï¼‰ã€‚ | - |
| | `[n].Type` | `...__Type` | ç®—æ³•ç±»å‹ï¼š`FixedWindow`, `SlidingWindow`, `TokenBucket`, `Concurrency`ã€‚ | `FixedWindow` |
| | `[n].PermitLimit` | `...__PermitLimit` | æ¯ä¸ªæ—¶é—´çª—å£å…è®¸çš„æœ€å¤§è¯·æ±‚æ•°ã€‚ | - |
| | `[n].WindowSeconds` | `...__WindowSeconds` | æ—¶é—´çª—å£é•¿åº¦ï¼ˆå•ä½ï¼š**ç§’**ï¼‰ã€‚ | - |
| | `[n].QueueLimit` | `...__QueueLimit` | è¶…è¿‡é™åˆ¶æ—¶å…è®¸æ’é˜Ÿçš„è¯·æ±‚æ•°ã€‚ | `0` |
| **èµ„æº** | `MaxFileSizeMB` | `AssetSettings__MaxFileSizeMB` | ä¸Šä¼ æ–‡ä»¶çš„æœ€å¤§å¤§å°ï¼ˆMBï¼‰ã€‚ | `5` |
| | `AllowedImageTypes` | `AssetSettings__AllowedImageTypes` | å…è®¸ä¸Šä¼ çš„å›¾ç‰‡ MIME ç±»å‹åˆ—è¡¨ã€‚ | `["image/jpeg", ...]` |
| **è·¨åŸŸ** | `AllowedOrigins` | `CorsSettings__AllowedOrigins` | å…è®¸çš„å‰ç«¯åŸŸåï¼ˆå¦‚ `https://example.com` æˆ– `*`ï¼‰ã€‚ | `[]` |


> **æ³¨æ„ï¼š** ç”±äº `Policies` æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç¯å¢ƒå˜é‡éœ€ä½¿ç”¨ç´¢å¼•æ ¼å¼ï¼ˆä¾‹å¦‚ï¼š`RateLimitSettings__Policies__0__PolicyName` ä»£è¡¨ç¬¬ä¸€ä¸ªç­–ç•¥ï¼Œ`__1__` ä»£è¡¨ç¬¬äºŒä¸ªï¼‰ã€‚

## ğŸ—ï¸ éƒ¨ç½²æŒ‡å—

### æ–¹å¼ä¸€ï¼šDocker Composeï¼ˆæ¨èï¼‰

è¿™æ˜¯éƒ¨ç½²æœåŠ¡å™¨å’Œ PostgreSQL æ•°æ®åº“æœ€ç®€å•çš„æ–¹æ³•ã€‚

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½² (Linux)

1. **å‘å¸ƒåº”ç”¨ï¼š**
   ```bash
   dotnet publish -c Release -o ./publish
   ```
2. **ä¸Šä¼ æ–‡ä»¶** åˆ°æ‚¨çš„æœåŠ¡å™¨ç›®å½•ã€‚
3. **è®¾ç½®ç¯å¢ƒå˜é‡** é…ç½®ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“è¿æ¥ã€‚
4. **è¿è¡Œï¼š** `dotnet OpenBioCardServer.dll`

## ğŸ“ é¡¹ç›®ç»“æ„

```
OpenBioCardServer/
â”œâ”€â”€ Controllers/      # API æ§åˆ¶å™¨
â”œâ”€â”€ Data/             # EF Core ä¸Šä¸‹æ–‡ä¸è¿ç§»
â”œâ”€â”€ Middlewares/      # ä¸­é—´ä»¶ (å¦‚é™æµé…ç½®)
â”œâ”€â”€ Models/           # æ•°æ®åº“å®ä½“æ¨¡å‹
â”œâ”€â”€ Services/         # ä¸šåŠ¡é€»è¾‘ (Auth, User, Admin)
â”œâ”€â”€ Utilities/        # å·¥å…·ç±»
â”œâ”€â”€ Program.cs        # ç¨‹åºå…¥å£ä¸ä¾èµ–æ³¨å…¥é…ç½®
â”œâ”€â”€ appsettings.json  # é…ç½®æ–‡ä»¶
â””â”€â”€ Dockerfile        # å®¹å™¨æ„å»ºæ–‡ä»¶
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **æ¡†æ¶:** .NET 10 / ASP.NET Core
- **ORM:** Entity Framework Core
- **æ•°æ®åº“:** PostgreSQL / MySQL / SQLite
- **æ–‡æ¡£:** Microsoft.AspNetCore.OpenApi

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

---
